<!DOCTYPE html>
<html lang="es">
<head>
	<title>Gu√≠a para desarrollar plugins de QGIS</title>	
	
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<meta name="google-site-verification" content="V6vOM4WVx1y0lZIvHHFBtzEfy8fyn3lMLuCdLiQkPtQ">
	
	<meta name="description" content="Portfolio de Roberto Jim√©nez - Especialista en Sistemas de Informaci√≥n Geogr√°fica y Geoespacial">
	<meta name="keywords" content="Tutorial, Desarrollo, QGIS, PLugins, Qt5, PyQGIS">
	<meta name="author" content="Roberto Jim√©nez">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="../styles/social.css">
	<link rel="stylesheet" href="../styles/styles.css">
	
	<link rel="icon" type="image/x-icon" href="favicon.ico">

		
</head>

	<body>
            
		<div class="cabecera">

			<div class="navbar">
				<ul>
					<li><a href="https://roberer.github.io/">Proyectos</a></li>
					<li><a class="active" href="https://roberer.github.io/tutoriales">Apuntes y tutoriales</a></li>
					<li><a href="https://roberer.github.io/blog">Blog</a></li>
					<li><a href="https://roberer.github.io/contacto">Contacto</a></li>
					<li style="float:right"><a href="https://twitter.com/roberer_" class="fa fa-twitter"></a></li>
					<li style="float:right"><a href="https://www.linkedin.com/in/robertojl" class="fa fa-linkedin"></a></li>
					<li style="float:right"><a href="https://github.com/roberer" class="fa fa-github"></a></li>
				</ul>
			</div>
	
	
			<div id="myNav" class="overlay">
				<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
				<div class="overlay-content">
					<a href="https://roberer.github.io/">Proyectos</a>
					<a class="active2" href="https://roberer.github.io/tutoriales">Tutoriales</a>
					<a href="https://roberer.github.io/blog">Blog</a>
					<a href="https://roberer.github.io/contacto">Contacto</a>
					<br><br>
					
						<div class="social-mobile">
							<div style="padding-right: 10px;"><a href="https://twitter.com/roberer_" class="fa fa-twitter"></a></div>
							<div style="padding-right: 10px;"><a href="https://www.linkedin.com/in/robertojl" class="fa fa-linkedin"></a></div>
							<div style="padding-right: 10px;"><a href="https://github.com/roberer" class="fa fa-github"></a></div>
						</div>
					
	
	
				</div>
			</div>
	
			<span style="font-size:30px;cursor:pointer" onclick="openNav()">
			<div class="navbar2">
				<div class="bar1"></div>
				<div class="bar2"></div>
				<div class="bar3"></div>
			</div></span>
	
	
			<div class="navbar3">
				<ul>
					<li style="color:rgb(0, 0, 0, 0,5); font-size:larger;" onclick="openNav()"><i>/tutoriales</i>üó∫Ô∏è</li>
					<li style="float:right"><span style="font-size:30px;cursor:pointer" onclick="openNav()">
						<div class="navbar2">
							<div class="bar1"></div>
							<div class="bar2"></div>
							<div class="bar3"></div>
						</div>
					</span></li>
					
				</ul>
			</div>
	
			<script>
	
				function openNav() {
					document.getElementById("myNav").style.width = "100%";
					}
	
					function closeNav() {
					document.getElementById("myNav").style.width = "0%";
				}
	
			</script>
	
				<div class="spacer"></div>

				<h1>Gu√≠a para desarrollar plugins de QGIS</h1>
				
			<div class="mifoto">
				<img alt="Roberer" src="https://raw.githubusercontent.com/roberer/roberer.github.io/main/img/img1.JPG">
			</div>
	
			
	
			<h2 align="center">Por Roberto Jim√©nez</h2>
			<h3 align="center" style="color:rgb(171, 171, 171)"><i>Geospatial & GIS specialist</i></h3>
		
				
		</div>	

		<div class="cuerpo">
			
			<h3><strong>√çndice</strong></h3>
			<div class="indice">
						
					<ul>
						<li><a href="#plugins">Los plugins de QGIS</a><br></li>
						<li><a href="#comenzar">Antes de empezar</a><br></li>
						<li><a href="#estructura">Crear la estructura base</a><br></li>
						<li><a href="#compilar">Compilar el plugin</a><br></li>
						<li><a href="#instalacion">Instalar el plugin en QGIS</a><br></li>
						<li><a href="#interfaz">Dise√±ar la interfaz</a><br></li>
						<li><a href="#programar">Programar el script</a><br></li>
						<li><a href="#funcionalidad">Funcionalidad de la interfaz</a><br></li>
						<li><a href="#algoritmo">Programar el algoritmo</a><br></li>
						<li><a href="#resultados">Resultados</a><br></li>
					</ul>
					<br>
			</div>
		
			<p><a id="plugins"></a></p>
		
			<p>Los plugins o complementos son extensiones que extienden la funcionalidad de QGIS m√°s all√° de las posibilidades que trae por defecto. De hecho, una de las cuestiones m√°s importantes acerca de QGIS y su concepci√≥n como Sistema de Informaci√≥n Geogr√°fica <em>libre</em> es precisamente que cualquiera con los conocimientos apropiados contribuya a aumentar sus funcionalidades a trav√©s de estos plugins.</p>



				<p>QGIS cuenta con un completo <a rel="noreferrer noopener" href="https://plugins.qgis.org/plugins/" target="_blank">repositorio de plugins</a> al cual podemos acceder directamente desde el propio programa de escritorio, realizar b√∫squedas e instalarlos en un momento, as√≠ como compartir los que hayamos credo nosotros. </p>



				<img src="https://programapa.files.wordpress.com/2021/04/plugins_qgis.png?w=1024" alt="" class="wp-image-6043" srcset="https://programapa.files.wordpress.com/2021/04/plugins_qgis.png?w=1024 1024w, https://programapa.files.wordpress.com/2021/04/plugins_qgis.png?w=150 150w, https://programapa.files.wordpress.com/2021/04/plugins_qgis.png?w=300 300w, https://programapa.files.wordpress.com/2021/04/plugins_qgis.png?w=768 768w, https://programapa.files.wordpress.com/2021/04/plugins_qgis.png 1363w" sizes="(max-width: 1024px) 100vw, 1024px" />



				<p class="has-text-align-left">A diferencia de las <a href="https://programapa.wordpress.com/2021/04/23/crear-herramientas-de-procesamiento-en-qgis-con-python/">herramientas de geoproceso</a>, los plugins otorgan una mayor libertad para personalizar la ventana gr√°fica de la herramienta o la estructura de los algoritmos que queremos que se ejecuten. Hay de todo tipo: algunos funcionan pr√°cticamente como herramientas de geoproceso, pero otros a√±aden maravillosas funcionalidades como la de <a rel="noreferrer noopener" href="https://www.cartografiadigital.es/2017/09/de-qgis-google-earth-y-viceversa.html" target="_blank">mostrar nuestro lienzo de QGIS en GoogleEarth</a> o <a rel="noreferrer noopener" href="https://mappinggis.com/2016/09/plugin-quickmapservices-capas-base-de-google-landsat-openstreetmap-para-qgis/" target="_blank">tener a mano un cat√°logo de mapas base</a>.</p>


			<p><a id="comenzar"></a></p>


					<p>Para crear nuestros plugins necesitaremos tener listo lo siguiente:</p>





			<p><a id="osgeo"></a></p>


			<h3><strong>&#8211; Instalaci√≥n de QGIS con OSGeo</strong></h3>



			<p>La instalaci√≥n de QGIS a trav√©s del paquete de OSGeo (OSGeo4W para Windows) es necesaria para la creaci√≥n de plugins puesto que incluye la consola <em>Shell</em> necesaria para compilar el plugin y QtDesigner.</p>



			<p>Pod√©is <a rel="noreferrer noopener" href="https://www.osgeo.org/projects/osgeo4w/" target="_blank">descargarlo desde aqu√≠</a></p>






			<p><a id="ide"></a></p>


			<h3><strong>&#8211; IDE Python</strong></h3>



			<p>Para programar en Python es recomendable en muchas ocasiones usar una IDE como Pycharm o VSCode para trabajar c√≥modamente, aunque tambi√©n puede hacerse a trav√©s del editor de texto de la consola de Python de QGIS.</p>






			<p><a id="plugin_builder"></a></p>


			<h3><strong>&#8211; <a href="https://plugins.qgis.org/plugins/pluginbuilder3/">Plugin </a><a rel="noreferrer noopener" href="https://plugins.qgis.org/plugins/pluginbuilder3/" target="_blank">Builder 3 </a></strong></h3>



			<p>Este plugin nos permite crear autom√°ticamente toda la estructura de archivos b√°sica necesaria para construir el plugin. Bastar√° con instalarlo a trav√©s del administrador de complementos de QGIS e iniciarlo desde el propio QGIS para comenzar a crear el plugin. </p>






			<p><a id="plugin_reloader"></a></p>


			<h3><strong>&#8211; Plugin Reloader</strong></h3>



			<p>Con este plugin podremos actualizar nuestro plugin para ver en tiempo real los cambios que hagamos durante su creaci√≥n y probar si las caracter√≠sticas que implementamos dan los resultados esperados.</p>






			<p><a id="qtdesigner"></a></p>


			<h3><strong>&#8211; QtDesigner</strong></h3>



			<p>Este programa servir√° para construir la salida gr√°fica de nuestro plugin a trav√©s de un lienzo en el que podremos colocar distintos objetos y enlazarlos con los objetos de nuestro c√≥digo de Python.</p>



			<p>QtDesigner puede descargarse o venir integrado con la instalaci√≥n de QGIS a trav√©s del paquete de <a rel="noreferrer noopener" href="https://www.osgeo.org/projects/qgis/" target="_blank">OSGeo4W</a>. ¬øNo parece de QGIS verdad? Ocurre que <a rel="noreferrer noopener" href="https://qgis.org/es/site/getinvolved/development/development.html" target="_blank">QGIS est√° desarrollado en base a Qt</a>, un framework que provee herramientas de desarrollo que tambi√©n es utilizado por otras aplicaciones inform√°ticas, y entre estas herramientas se encuentra QtDesigner.</p>






			<p><a id="multiexploding"></a></p>


			<h2><strong>Pasos a seguir</strong></h2>



			<p>Vamos a crear un plugin que realice un <a rel="noreferrer noopener" href="https://docs.qgis.org/3.16/es/docs/user_manual/processing_algs/qgis/vectorgeometry.html#qgismultiparttosingleparts" target="_blank">Multiparte a partes sencillas</a> a todas las capas vectoriales que se encuentren en una carpeta, dado que la herramienta de procesamiento que proporciona QGIS solo permite aplicarlo a una capa cada vez que se ejecuta.</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/multiparts.png?w=395" alt="" class="wp-image-6238" width="270" height="268" srcset="https://programapa.files.wordpress.com/2021/05/multiparts.png?w=270 270w, https://programapa.files.wordpress.com/2021/05/multiparts.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/multiparts.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/multiparts.png 395w" sizes="(max-width: 270px) 100vw, 270px" />



			<p>Este es un procedimiento b√°sico en el control de calidad de datos geogr√°ficos y se le conoce en ingl√©s como <em>Exploding Multipart Polygons</em>. A nuestro nuevo plugin lo llamaremos <strong><em>MultiExploding</em>.</strong></p>



			<p>Para entender m√°s a fondo lo que expongo a continuaci√≥n recomiendo echarle un vistazo a los otros posts que tengo sobre Python y QGIS:</p>






			<p><a id="estructura"></a></p>


			<h3 class="has-text-align-left"><strong>1 &#8211; Crear la estructura base del plugin con Plugin Builder 3</strong></h3>



			<p>El primer paso ser√° instalar Plugin Builder 3 en QGIS, activarlo e iniciarlo. Una vez hecho esto, se abrir√° la siguiente ventana:</p>



			<img src="https://programapa.files.wordpress.com/2021/05/image-1.png?w=577" alt="" class="wp-image-6207" srcset="https://programapa.files.wordpress.com/2021/05/image-1.png 577w, https://programapa.files.wordpress.com/2021/05/image-1.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/image-1.png?w=300 300w" sizes="(max-width: 577px) 100vw, 577px" />



			<p>Debemos rellenar todos los datos que pide. Como pod√©is observar, se sugieren ejemplos para introducir correctamente los nombres de la nueva clase de Python que se va a crear, el m√≥dulo etc.</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/plugin_builder.png?w=674" alt="" class="wp-image-6240" width="543" height="383" srcset="https://programapa.files.wordpress.com/2021/05/plugin_builder.png?w=543 543w, https://programapa.files.wordpress.com/2021/05/plugin_builder.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/plugin_builder.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/plugin_builder.png 674w" sizes="(max-width: 543px) 100vw, 543px" />



			<p>El siguiente paso ser√° rellanar el <em>About</em>, que es la descripci√≥n detallada de lo que hace el plugin que aparecer√° en el repositorio oficial en caso de que lo compartamos.</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/plugin_builder1.png?w=665" alt="" class="wp-image-6241" width="472" height="334" srcset="https://programapa.files.wordpress.com/2021/05/plugin_builder1.png?w=470 470w, https://programapa.files.wordpress.com/2021/05/plugin_builder1.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/plugin_builder1.png?w=300 300w" sizes="(max-width: 472px) 100vw, 472px" />



			<p>A continuaci√≥n tendremos que escoger una plantilla para nuestro plugin, el men√∫ en el que aparecer√° el plugin cuando lo a√±adamos a QGIS y un texto descriptivo que aparecer√° en dicho men√∫:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/plugin_builder2.png?w=671" alt="" class="wp-image-6243" width="562" height="398" srcset="https://programapa.files.wordpress.com/2021/05/plugin_builder2.png?w=562 562w, https://programapa.files.wordpress.com/2021/05/plugin_builder2.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/plugin_builder2.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/plugin_builder2.png 671w" sizes="(max-width: 562px) 100vw, 562px" />



			<p>El siguiente paso es para pedir que se creen archivos adicionales que pueden ser de utilidad. Por defecto se encuentran marcados:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/plugin_builder8.png" alt="" class="wp-image-6362" width="411" height="356" srcset="https://programapa.files.wordpress.com/2021/05/plugin_builder8.png?w=411&amp;h=356 411w, https://programapa.files.wordpress.com/2021/05/plugin_builder8.png?w=150&amp;h=130 150w, https://programapa.files.wordpress.com/2021/05/plugin_builder8.png?w=300&amp;h=259 300w, https://programapa.files.wordpress.com/2021/05/plugin_builder8.png 548w" sizes="(max-width: 411px) 100vw, 411px" />



			<p>Por √∫ltimo, podemos a√±adir distintos enlaces para compartir el repositorio de c√≥digo del plugin, la p√°gina web o las etiquetas que mejor describan nuestro plugin para que sea encontrado f√°cilmente. Adem√°s, podemos marcar el plugin como experimental para advertir que no est√° completo y/o puede generar resultados no deseados:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/plugin_builder3.png?w=673" alt="" class="wp-image-6244" width="585" height="413" srcset="https://programapa.files.wordpress.com/2021/05/plugin_builder3.png?w=585 585w, https://programapa.files.wordpress.com/2021/05/plugin_builder3.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/plugin_builder3.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/plugin_builder3.png 673w" sizes="(max-width: 585px) 100vw, 585px" />



			<p>Una vez hecho todo esto, guardaremos el plugin en la ruta que queramos. En el directorio escogido se crear√° una nueva carpeta con el nombre del plugin en la que se encontrar√°n todos los archivos del plugin:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/plugin_builder4.png?w=670" alt="" class="wp-image-6245" width="586" height="416" srcset="https://programapa.files.wordpress.com/2021/05/plugin_builder4.png?w=586 586w, https://programapa.files.wordpress.com/2021/05/plugin_builder4.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/plugin_builder4.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/plugin_builder4.png 670w" sizes="(max-width: 586px) 100vw, 586px" />



			<p>Si todo ha salido bien, se mostrar√° el siguiente mensaje:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/plugin_builder6.png?w=775" alt="" class="wp-image-6247" width="666" height="598" srcset="https://programapa.files.wordpress.com/2021/05/plugin_builder6.png?w=666 666w, https://programapa.files.wordpress.com/2021/05/plugin_builder6.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/plugin_builder6.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/plugin_builder6.png?w=768 768w, https://programapa.files.wordpress.com/2021/05/plugin_builder6.png 775w" sizes="(max-width: 666px) 100vw, 666px" />






			<p><a id="compilar"></a></p>


			<h3 class="has-text-align-left"><strong>2 &#8211; Compilar manualmente el nuevo plugin</strong></h3>



			<p>Es muy probable que al crear el plugin haya saltado el siguiente error:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/plugin_builder5.png?w=521" alt="" class="wp-image-6246" width="446" height="158" srcset="https://programapa.files.wordpress.com/2021/05/plugin_builder5.png?w=446 446w, https://programapa.files.wordpress.com/2021/05/plugin_builder5.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/plugin_builder5.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/plugin_builder5.png 521w" sizes="(max-width: 446px) 100vw, 446px" />



			<p>Significa que no pudo compilarse (en resumen, traducirse al lenguaje del PC para que funcione) y que tendremos que hacerlo manualmente, pero es muy sencillo. Debemos abrir la terminal &#8211; Shell &#8211; de OSGEO e introducir los siguientes comandos:</p>


			<pre>
			cd C:\ruta_carpeta_plugin
			call qt5_env.bat
			py3_env.bat
			pyrcc5 ‚Äìo resources.py resources.qrc
			</pre><br>


			<p>Si todo ha salido bien, el proceso completo ser√≠a el siguiente:</p>



			<img src="https://programapa.files.wordpress.com/2021/05/image-9.png?w=1024" alt="" class="wp-image-6249" srcset="https://programapa.files.wordpress.com/2021/05/image-9.png?w=1024 1024w, https://programapa.files.wordpress.com/2021/05/image-9.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/image-9.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/image-9.png?w=768 768w, https://programapa.files.wordpress.com/2021/05/image-9.png 1111w" sizes="(max-width: 1024px) 100vw, 1024px" />



			<p>La estructura de archivos dentro del plugin quedar√≠a de la siguiente manera:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/image-10.png?w=774" alt="" class="wp-image-6252" width="626" height="406" srcset="https://programapa.files.wordpress.com/2021/05/image-10.png?w=626 626w, https://programapa.files.wordpress.com/2021/05/image-10.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/image-10.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/image-10.png?w=768 768w, https://programapa.files.wordpress.com/2021/05/image-10.png 774w" sizes="(max-width: 626px) 100vw, 626px" />







			<h3><strong>3 &#8211; Instalaci√≥n del nuevo plugin en QGIS</strong></h3>



			<p>Con el plugin ya compilado, tan solo tendremos que copiarlo a la carpeta de plugins de QGIS y, si tenemos QGIS abierto, reiniciarlo.</p>



			<p>En Windows, la carpeta de plugins de QGIS suele encontrarse en <pre>C:\Users\Usuario\AppData\Roaming\QGIS\QGIS3\profiles\default\python\plugins</pre></p>



			<p>Una vez abierto de nuevo QGIS, recordad <strong>activar el plugin</strong> desde el administrador de complementos.</p>







			<h3 class="has-text-align-left"><strong>4 &#8211; Dise√±ar la interfaz</strong></h3>



			<p>Para dise√±ar la interfaz tendremos que abrir <a href="https://doc.qt.io/qt-5/qtdesigner-manual.html" target="_blank" rel="noreferrer noopener">QtDesigner</a> y abrir con √©l un archivo que encontraremos dentro de la carpeta del plugin llamado <em>nombreplugin_dialog_base.ui </em>(en mi caso <em>Multi_Exploding_dialog_base.ui</em>) que es el que contiene los datos relativos a la interfaz de usuario del plugin.</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/qtdesigner1.png?w=1024" alt="" class="wp-image-6254" width="729" height="400" srcset="https://programapa.files.wordpress.com/2021/05/qtdesigner1.png?w=1024 1024w, https://programapa.files.wordpress.com/2021/05/qtdesigner1.png?w=727 727w, https://programapa.files.wordpress.com/2021/05/qtdesigner1.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/qtdesigner1.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/qtdesigner1.png?w=768 768w, https://programapa.files.wordpress.com/2021/05/qtdesigner1.png 1264w" sizes="(max-width: 729px) 100vw, 729px" />



			<p>La ventana que se abre dentro de Qt Designer ser√° el lienzo en el que montaremos la interfaz de usuario de nuestro plugin, es decir, los botones para seleccionar la carpeta de entrada, los par√°metros con los que queremos que se ejecute la herramienta, el nombre de la carpeta de salida&#8230;</p>



			<p>La plantilla que hayamos seleccionado en la creaci√≥n del plugin con Plugin Builder 3 determinar√° el aspecto que presentar√° nuestra interfaz. Al haber seleccionado <em>Tool button with dialog </em>obtendremos la cl√°sica ventana con los botones de <em>aceptar </em>para ejecutar la herramienta y <em>cancelar </em>para cerrarla.</p>



			<p>Lo siguiente que tendremos que hacer ser√° arrastrar los widgets que necesitemos desde las cajas de la izquierda a nuestro lienzo. Para nuestro plugin necesitaremos:</p>



			<ul><li><strong>Push Button</strong> &#8211; bot√≥n para acceder al sistema de archivos y seleccionar manualmente la carpeta en la que se encuentren nuestras capas</li><li><strong>Line Edit</strong> <strong>1</strong> &#8211; cuadro de texto que recoger√° la ruta al directorio seleccionado anteriormente</li><li><strong>Line Edit 2</strong> &#8211; cuadro de texto en el que indicaremos el nombre de la carpeta de salida que se crear√° dentro de la carpeta de entrada y que almacenar√° las capas con las entidades explotadas.</li><li><strong>Labels</strong> &#8211; cuadros de texto con etiquetas para guiar al usuario a trav√©s de la herramienta</li></ul>



			<img  src="https://programapa.files.wordpress.com/2021/05/image-11.png?w=681" alt="" class="wp-image-6257" width="469" height="278" srcset="https://programapa.files.wordpress.com/2021/05/image-11.png?w=469 469w, https://programapa.files.wordpress.com/2021/05/image-11.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/image-11.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/image-11.png 681w" sizes="(max-width: 469px) 100vw, 469px" />



			<p>Podemos cambiar tanto la posici√≥n de los widgets como su tama√±o o la etiqueta que muestran:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/image-12.png?w=565" alt="" class="wp-image-6305" width="415" height="224" srcset="https://programapa.files.wordpress.com/2021/05/image-12.png?w=415 415w, https://programapa.files.wordpress.com/2021/05/image-12.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/image-12.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/image-12.png 565w" sizes="(max-width: 415px) 100vw, 415px" />



			<p>En la parte derecha de Qt Designer nos aparecer√°n las propiedades de cada uno de estos widgets y la posibilidad de modificarlas (algunas de ellas). Las m√°s b√°sicas que necesitamos conocer para programar el plugin son:</p>



			<ul><li><strong>objectName</strong> &#8211; es el nombre que usaremos en el script de Python para referirnos a cada objeto. Podemos modificarlo para que la sintaxis del script sea lo m√°s clara posible.</li><li><strong>Clase</strong> &#8211; la <a rel="noreferrer noopener" href="https://doc.qt.io/qt-5/qtwidgets-module.html" target="_blank">clase a la que pertenece cada widget</a>, necesaria para conocer a trav√©s de la documentaci√≥n oficial los distintos m√©todos que podremos aplicarle en nuestro script</li></ul>



			<img src="https://programapa.files.wordpress.com/2021/05/qtdesigner2.png?w=1024" alt="" class="wp-image-6323" srcset="https://programapa.files.wordpress.com/2021/05/qtdesigner2.png?w=1024 1024w, https://programapa.files.wordpress.com/2021/05/qtdesigner2.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/qtdesigner2.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/qtdesigner2.png?w=768 768w, https://programapa.files.wordpress.com/2021/05/qtdesigner2.png 1230w" sizes="(max-width: 1024px) 100vw, 1024px" />



			<p>En la <strong>documentaci√≥n de las clases </strong>de los widgets que hemos incorporado podremos encontrar los m√©todos que nos permitir√°n jugar con ellos:</p>



			<ul><li><a href="https://doc.qt.io/qt-5/qlabel.html" target="_blank" rel="noreferrer noopener">Documentaci√≥n de QLabel</a></li><li><a href="https://doc.qt.io/qt-5/qlineedit.html" target="_blank" rel="noreferrer noopener">Documentaci√≥n de QLineEdit</a></li><li><a href="https://doc.qt.io/qt-5/qpushbutton.html" target="_blank" rel="noreferrer noopener">Documentaci√≥n QPushButton</a></li></ul>



			<p>Una vez <strong>guardamos los cambios</strong>, si vamos a QGIS y <strong>recargamos el plugin usando Plugin Reloader</strong> (1) al volver a hacer click en nuestro plugin (2) se deber√≠an ver los cambios hechos en la interfaz:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/image-13.png?w=757" alt="" class="wp-image-6315" width="469" height="327" srcset="https://programapa.files.wordpress.com/2021/05/image-13.png?w=469 469w, https://programapa.files.wordpress.com/2021/05/image-13.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/image-13.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/image-13.png 757w" sizes="(max-width: 469px) 100vw, 469px" />






			<p><a id="programar"></a></p>


			<h3><strong>5 &#8211; Programar el script</strong></h3>



			<p>El √∫ltimo paso consiste en programar el script para darle funcionalidad a la interfaz y hacer que se ejecute el algoritmo de Multiparte a partes sencillas para todas las entidades de todos los archivos vectoriales de la carpeta de entrada, y que sus resultados se almacenen en la carpeta con el nombre indicado (que se localizar√° dentro de la carpeta de entrada)</p>



			<p>Para ello, tendremos que abrir con un IDE (VSCode en las capturas) el archivo <em>nombreplugin.py</em> que encontraremos en la carpeta del plugin. En mi caso, dicho archivo es <em>Multi_Exploding.py</em>.</p>



			<img src="https://programapa.files.wordpress.com/2021/05/image-15.png?w=1024" alt="" class="wp-image-6326" srcset="https://programapa.files.wordpress.com/2021/05/image-15.png?w=1024 1024w, https://programapa.files.wordpress.com/2021/05/image-15.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/image-15.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/image-15.png?w=768 768w, https://programapa.files.wordpress.com/2021/05/image-15.png 1156w" sizes="(max-width: 1024px) 100vw, 1024px" />



			<p>Al abrirlo veremos que la <strong>estructura b√°sica</strong> del script se encuentra ya creada gracias a Model Builder 3. La estructura es muy similar a <a href="https://programapa.wordpress.com/2021/04/23/crear-herramientas-de-procesamiento-en-qgis-con-python/">la que vemos en las herramientas de geoproceso</a>:</p>



			<ol><li>Codificaci√≥n del sistema y descripci√≥n del plugin</li><li>Importaci√≥n de m√≥dulos</li><li>Creaci√≥n de la nueva clase MultiExploding </li></ol>



			<p>La mayor diferencia respecto a las herramientas de geoproceso va a estar en c√≥mo definiremos la nueva clase. En esta ocasi√≥n no usaremos la herencia para basar nuestro plugin en otra clase, y tampoco tendremos que definir los par√°metros justo al comienzo de la clase. </p>



			<p>Nos encontraremos los siguientes <strong>m√©todos ya definidos</strong> para nuestra nueva clase:</p>



			<table><tbody><tr><td>def __init__(self, iface)</td><td>Constructor de clase</td></tr><tr><td>def&nbsp;tr(self,&nbsp;message)</td><td>Traductor de la interfaz</td></tr><tr><td>def add_action(self, iconpath&#8230;) </td><td>Configuraci√≥n del icono en la barra de herramientas de QGIS</td></tr><tr><td>def&nbsp;initGui(self)</td><td>Integra el plugin en la interfaz de usuario de QGIS</td></tr><tr><td>def&nbsp;unload(self)</td><td>Configura el proceso de eliminaci√≥n del plugin de la interfaz de QGIS</td></tr><tr><td>def&nbsp;run(self)</td><td>C√≥digo que se ejecutar√° una vez se abra el plugin</td></tr></tbody></table>



			<p>Por lo general, no ser√° necesario editar ninguno de estos m√©todos salvo <em>run</em>, que es el que ejecutar√° las funciones que implementemos al script. </p>



			<p>Lo que s√≠ tendremos que hacer es <strong>crear un nuevo m√©todo</strong> para dar funcionalidad a la interfaz de nuestro plugin, como veremos en el siguiente punto.</p>



			<p>‚ö† <em>Self</em> es el nombre que habitualmente se le da al objeto que representa a la propia clase. <em>Iface</em> es el nombre obligatorio para referenciar la interfaz de QGIS. Ambos quedaron definidos por Plugin Builder 3 en el m√©todo <em>__init__</em> al comienzo de la clase. </p>






			<p><a id="funcionalidad"></a></p>


			<h4><strong>5.1 &#8211; Programar el Push Button y el Line Edit para obtener la ruta de entrada</strong></h4>



			<p>Lo primero que debemos hacer es <strong>definir un nuevo m√©todo</strong> llamado <em>select_input_folder</em> para nuestra clase (<em>self</em>)<em> </em>por el cual, cuando se invoque, se acceda al sistema de archivos del PC y se copie nuestro Line Edit (nombrado por defecto <em>lineEdit</em>) la ruta de la carpeta seleccionada:</p>


			<pre>
			def select_input_folder(self):
					inputfolder = QFileDialog.getExistingDirectory(self.dlg,"Choose input directory", 
							"",QFileDialog.DontResolveSymlinks)
					self.dlg.lineEdit.setText(inputfolder)
			</pre><br>


			<p>Dicho m√©todo lo hemos colocado justo despu√©s del m√©todo <em>unload </em>que ya ven√≠a definido. Lo que hace es guardar en el objeto <em>inputfolder </em>la ruta seleccionada y lo inserta con <em>.setText() </em>en el Line Edit.</p>



			<p>Para que <strong>al pulsar el bot√≥n accedamos al sistema de archivos</strong> deberemos a√±adir la l√≠nea resaltada en la sentencia <em>if</em> que hay al comienzo del bloque <em>run</em>:</p>


			<pre>
			def run(self):
					"""Run method that performs all the real work"""

					# Create the dialog with elements (after translation) and keep reference
					# Only create GUI ONCE in callback, so that it will only load when the plugin is started
					if self.first_start == True:
						self.first_start = False
						self.dlg = MultiExplodingDialog()
						self.dlg.pushButton.clicked.connect(self.select_input_folder)
			</pre><br>


			<p>Dentro de esta sentencia <em>if </em>a√±adiremos todas aquellas conexiones de que queremos que se establezcan al abrir el plugin dentro de QGIS. En este caso, lo que hacemos es indicar con los m√©todos <em>.clicked.connect()</em> que cuando hagamos click a nuestro bot√≥n de nombre <em>pushButton </em>se ejecute el m√©todo <em>.select_input_folder </em>que hemos definido anteriormente.</p>



			<p>El √∫ltimo paso para que funcione ser√° importar la <a rel="noreferrer noopener" href="https://doc.qt.io/qt-5/qfiledialog.html#details" target="_blank">clase QFileDialog</a> al comienzo de nuestro script para poder navegar por el sistema de archivos:</p>


			<pre>
			from qgis.PyQt.QtWidgets import QAction, QFileDialog
			</pre><br>


			<p>Guardamos los cambios, recargamos el plugin con Plugin Reloader y probamos si funciona:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/push_button.png?w=787" alt="" class="wp-image-6367" width="494" height="368" srcset="https://programapa.files.wordpress.com/2021/05/push_button.png?w=494 494w, https://programapa.files.wordpress.com/2021/05/push_button.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/push_button.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/push_button.png?w=768 768w, https://programapa.files.wordpress.com/2021/05/push_button.png 787w" sizes="(max-width: 494px) 100vw, 494px" />






			<p><a id="linedit"></a></p>


			<h4><strong>5.2 &#8211; Limpiar los Line Edit</strong></h4>



			<p>Tanto el primer Line Edit (<em>lineEdit</em>) como el segundo (<em>lineEdit_2</em>) por defecto almacenar√°n el texto que contengan aunque cerremos el plugin y volvamos a abrirlo. Para evitar esto, a√±adiremos las siguientes l√≠neas dentro de <em>run </em>(despu√©s de la sentencia <em>if </em>que ya modificamos previamente) para que ambos Line Edits se limpien al iniciar el plugin:</p>


			<pre>
			self.dlg.lineEdit.setText('')
			self.dlg.lineEdit_2.setText('')
			</pre><br>


			<p>Es tan sencillo como aplicar el m√©todo <em>.setText()</em> a los Line Edits y darles un texto vac√≠o.</p>






			<p><a id="algoritmo"></a></p>


			<h4><strong>5.3 &#8211; Programar la ejecuci√≥n del algoritmo</strong></h4>



			<p>Lo √∫nico que nos quedar√≠a es indicar qu√© ocurre cuando pulsemos el bot√≥n de ACEPTAR de nuestro plugin. B√°sicamente, se tomar√° el texto de nuestros Line Edits como variables de entrada y salida del algoritmo <a rel="noreferrer noopener" href="https://docs.qgis.org/3.16/es/docs/user_manual/processing_algs/qgis/vectorgeometry.html#qgismultiparttosingleparts" target="_blank">Multiparte a partes sencillas</a> que queremos aplicar a todos los shapefiles de la carpeta seleccionada.</p>



			<p>Lo primero ser√° <strong>importar los siguientes m√≥dulos:</strong></p>



			<ul><li><em><strong>processing</strong></em> &#8211; para poder usar el algoritmo <em>Multipart to Singlepart</em></li><li><strong><em>os </em></strong><em>&#8211; </em>para crear la carpeta de salida</li><li><strong><em>shutil </em></strong><em>&#8211; </em>para borrar la carpeta de resultados en caso de que ya exista</li><li><em><strong>QgsVectorLayer </strong></em>&#8211; para poder cargar capas vectoriales</li><li><strong><em>QgsField </em></strong><em>&#8211; </em>para crear un nuevo campo que asigne un ID √∫nico a cada entidad, ya que al dividirse las nuevas entidades conservan los atributos de la entidad original</li><li><strong style="color:initial;"><em>iface</em></strong><span style="color:initial;"> &#8211; para poder a√±adir a nuestro proyecto QGIS todas las nuevas capas y generar una barra de progreso en la interfaz</span></li></ul>


			<pre>
			from qgis.core import QgsVectorLayer, QgsField
			from qgis.utils import iface
			import processing
			import os
			import shutil
			</pre><br>


			<p>A continuaci√≥n, nos iremos a la sentencia <em>if result </em>que se encuentra al final del script&#8230;</p>


			<pre>
			if result:
						# Do something useful here - delete the line containing pass and
						# substitute with your code.
						pass
			</pre><br>


			<p> &#8230; y tal como se indica sustituiremos su contenido por todo aquello que queramos que suceda al pulsar ACEPTAR (o ejecutar) Lo ten√©is a detallado a continuaci√≥n:</p>


			<pre>
					if result:

						## objetos con las rutas de entrada y salida a partir de los Line Edits
						entrada = self.dlg.lineEdit.text() + '/'
						nombre_salida = self.dlg.lineEdit_2.text()
						salida = entrada + nombre_salida + '/'

						## filtrar los ficheros de la carpeta de entrada 
						listaFicheros = os.listdir(entrada)
						ext = '.shp'
						listaShp = &#91;]

						for i in listaFicheros:
							if os.path.splitext(i)&#91;1] == ext:
								listaShp.append(i)

						## comprobar si existe la capa de salida
						if os.path.exists(salida):
							shutil.rmtree(salida)
							os.mkdir(salida)
						else:
							os.mkdir(salida)

						## por cada capa de nuestra lista de capas
						for f in listaShp:

							## obtener su nombre sin la extension
							nombre = os.path.splitext(f)&#91;0]

							## cargar el archivo como capa vectorial
							capa = QgsVectorLayer(entrada + f, nombre, 'ogr')

							## definir la ruta de salida completa, incluyendo el nombre y la extension
							output = salida + nombre + '_exploded' + '.shp'

							## generar una barra de progreso cuando se ejecute el plugin
							iface.messageBar().pushInfo(u'Exploding features', output)

							## definir en un diccionario los parametros del algoritmo
							params = {'INPUT': capa, 'OUTPUT': output}

							## ejecutar el algoritmo
							processing.run('qgis:multiparttosingleparts', params)

							## nuevo campo id autoincrementable
							capa2 = QgsVectorLayer(output,nombre,'ogr')
							capa2.startEditing()

							capa2.dataProvider().addAttributes(&#91;QgsField('newID', QVariant.Int)])
							capa2.updateFields()
							
							entidades = capa2.getFeatures()
							contador = 0

							for entidad in entidades:
								entidad&#91;'newID'] = contador
								capa2.updateFeature(entidad)
								contador += 1
								
							capa2.commitChanges()

							## cargar la capa resultante al proyecto
							iface.addVectorLayer(output, nombre + '_exploded', 'ogr')
						
			</pre><br>





			<p><a id="resultados"></a></p>


			<h2><strong>Resultados</strong></h2>



			<p>Pondremos a prueba el plugin aplic√°ndolo a dos capas que se encuentran en una carpeta de mi escritorio. Cada una contiene 3 pol√≠gonos distintos pero dos de ellos pertenecen a la misma entidad, es decir, son entidades multiparte:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/image-16.png?w=1024" alt="" class="wp-image-6381" width="768" height="405" srcset="https://programapa.files.wordpress.com/2021/05/image-16.png?w=1024 1024w, https://programapa.files.wordpress.com/2021/05/image-16.png?w=768 768w, https://programapa.files.wordpress.com/2021/05/image-16.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/image-16.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/image-16.png 1268w" sizes="(max-width: 768px) 100vw, 768px" />



			<p>Si abrimos sus atributos comprobamos que, efectivamente, cada una tiene solo 2 entidades y adem√°s solo cuentan con un √∫nico campo <em>id</em>:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/multiparts-1.png?w=965" alt="" class="wp-image-6387" width="724" height="542" srcset="https://programapa.files.wordpress.com/2021/05/multiparts-1.png?w=724 724w, https://programapa.files.wordpress.com/2021/05/multiparts-1.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/multiparts-1.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/multiparts-1.png?w=768 768w, https://programapa.files.wordpress.com/2021/05/multiparts-1.png 965w" sizes="(max-width: 724px) 100vw, 724px" />



			<p>A continuaci√≥n abrimos el nuevo plugin y seleccionamos la carpeta en la que se encuentran estas dos capas. Adem√°s, indicamos que la carpeta en la que se guardar√°n los resultados (que se ubicar√° dentro de la carpeta de entrada) se llamar√° <em>resultados:</em></p>



			<img  src="https://programapa.files.wordpress.com/2021/05/image-18.png?w=682" alt="" class="wp-image-6384" width="512" height="326" srcset="https://programapa.files.wordpress.com/2021/05/image-18.png?w=512 512w, https://programapa.files.wordpress.com/2021/05/image-18.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/image-18.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/image-18.png 682w" sizes="(max-width: 512px) 100vw, 512px" />



			<p>Vemos que la carpeta de resultados se cre√≥ correctamente y las capas creadas se a√±adieron autom√°ticamente a QGIS:</p>



			<img  src="https://programapa.files.wordpress.com/2021/05/multiparts2-1.png?w=1024" alt="" class="wp-image-6398" width="787" height="428" srcset="https://programapa.files.wordpress.com/2021/05/multiparts2-1.png?w=1024 1024w, https://programapa.files.wordpress.com/2021/05/multiparts2-1.png?w=785 785w, https://programapa.files.wordpress.com/2021/05/multiparts2-1.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/multiparts2-1.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/multiparts2-1.png?w=768 768w, https://programapa.files.wordpress.com/2021/05/multiparts2-1.png 1398w" sizes="(max-width: 787px) 100vw, 787px" />



			<p>Si a continuaci√≥n abrimos la tabla de atributos, vemos que se cre√≥ correctamente el nuevo campo de identificaci√≥n <em>newID</em> necesario para identificar de forma √∫nica cada entidad, puesto que al dividirse las nuevas entidades conservan los atributos de la entidad original: </p>



			<img  src="https://programapa.files.wordpress.com/2021/05/multiparts3-1.png?w=545" alt="" class="wp-image-6401" width="-52" height="-59" srcset="https://programapa.files.wordpress.com/2021/05/multiparts3-1.png 545w, https://programapa.files.wordpress.com/2021/05/multiparts3-1.png?w=130 130w, https://programapa.files.wordpress.com/2021/05/multiparts3-1.png?w=259 259w" sizes="(max-width: 545px) 100vw, 545px" />



			<p>Gracias a este nuevo campo podemos editar la simbolog√≠a de las capas nuevas para que cada una est√© representada por un color distinto:</p>



			<img src="https://programapa.files.wordpress.com/2021/05/multiparts4-1.png?w=1024" alt="" class="wp-image-6396" srcset="https://programapa.files.wordpress.com/2021/05/multiparts4-1.png?w=1024 1024w, https://programapa.files.wordpress.com/2021/05/multiparts4-1.png?w=150 150w, https://programapa.files.wordpress.com/2021/05/multiparts4-1.png?w=300 300w, https://programapa.files.wordpress.com/2021/05/multiparts4-1.png?w=768 768w, https://programapa.files.wordpress.com/2021/05/multiparts4-1.png 1495w" sizes="(max-width: 1024px) 100vw, 1024px" />



			<p>Ten√©is al plugin al completo <a href="https://github.com/roberer/PyQGIS-Plugins" target="_blank" rel="noreferrer noopener">en GitHub</a>.</p>
					
		</div>
	
	</body>



</html>
